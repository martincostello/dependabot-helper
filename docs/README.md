# Dependabot Helper

## Introduction

[Dependabot] is a great tool built into GitHub, but if you configure it to run
regularly across a large number of repositories, or it generates a lot of pull
requests each time it runs, the notifications it generates can be a bit
overwhelming and time-consuming to keep on top of.

[Dependabot]: https://docs.github.com/en/code-security/dependabot/dependabot-version-updates/about-dependabot-version-updates

_Dependabot Helper_ tries to make this more manageable by providing you with a
summary view of all the automated pull requests generated by the
`app/dependabot` and `app/github-actions` users against all of the repositories
you have access to that you choose to configure to manage updates for.

## Features

- Integrates with the [GitHub REST API].
- Acts as you via GitHub [OAuth] tokens (the default scope is `repo`).
- Works with both GitHub.com and [GitHub Enterprise Server] (_tested with GHES 3.2_).
- Supports being hosted as a web application and as an [AWS Lambda function].
- Configure access to your own repositories as well as organizations you are a member of.
  - Optionally supports private repositories and forks.
- View open pull requests created by specific users for each configured repository:
  - See the status of pull request checks and statuses.
  - See the number of approvals.
  - Approve individual pull requests.
  - Merge all mergeable pull requests at once.

[AWS Lambda function]: https://aws.amazon.com/blogs/compute/introducing-the-net-6-runtime-for-aws-lambda/
[GitHub Enterprise Server]: https://docs.github.com/en/enterprise-server/admin
[GitHub REST API]: https://docs.github.com/en/rest/guides/getting-started-with-the-rest-api
[OAuth]: https://docs.github.com/en/developers/apps/building-oauth-apps/scopes-for-oauth-apps

## Screenshots

### Configure repositories

[![Configure repositories to manage](./images/configure.png "Configure repositories")](#configure-repositories)

### Pull requests summary

[![Pull requests for configured repositories](./images/manage.png "Manage pull requests")](#pull-requests-summary)

### View pull requests

[![View the open pull requests for a repository](./images/pull-requests.png "View pull requests")](#view-pull-requests)

## FAQs

For answers to frequently asked questions about Dependabot Helper, see [this document](./faqs.md "Frequently Asked Questions").

## Installation

Dependabot Helper is an ASP.NET Core web application. [Building, publishing and deploying the application]
yourself requires a working familiarity with ASP.NET Core and your chosen
hosting platform (such as Linux or Windows). The application has also been
designed and tested to work when hosted in an AWS Lambda function using the
`dotnet6` managed runtime.

[Building, publishing and deploying the application]: https://docs.microsoft.com/aspnet/core/host-and-deploy

Beyond compiling and deploying the application yourself, the minimum requirement
to self-host Dependabot Helper is to create an OAuth application in GitHub.com
(or GitHub Enterprise Server) and configure the OAuth application's Client ID
and Client Secret (and domain for GitHub Enterprise Server). The documentation
to create an OAuth application in GitHub [can be found here].

[can be found here]: https://docs.github.com/developers/apps/building-oauth-apps/creating-an-oauth-app

If you wish to heavily customize the application, you should fork the repository
and make whichever changes you desire. Pull requests that improve the functionality
for all users and are in-keeping with the application's overall purpose are welcome!

If you wish to make only minor runtime customizations, such as configuring
logging, suggested ways of achieving this include overriding the
configuration options using environment variables, and deploying the application
with a custom assembly that contains an implementation of [`IStartupFilter`]
that is enabled at runtime using the [`ASPNETCORE_HOSTINGSTARTUPASSEMBLIES`]
environment variable.

[`IStartupFilter`]: https://andrewlock.net/exploring-istartupfilter-in-asp-net-core/
[`ASPNETCORE_HOSTINGSTARTUPASSEMBLIES`]: https://docs.microsoft.com/aspnet/core/fundamentals/host/platform-specific-configuration

## API Access and Data Storage

Users/organizations and repositories are cached in-memory for 10 minutes by
default to improve performance and improve GitHub API quota utilization. This
can be disabled for ephemeral deployments, such as AWS Lambda.

The repositories you select to manage are stored in your browser's local storage.

Your GitHub OAuth access token is stored encrypted in the web application's
authentication cookie (`.dependabothelper.authentication`).

You can audit the code for yourself, but the GitHub OAuth access token acquired
for your user when you log into the application is only used to:

- Get the organizations to which you have access.
- Get the repositories which belong to your account and to which you have access in the organizations you are a member of.
- Query issues and pull requests.
- Query commit checks and statuses.
- Query pull request approvals.
- Check if a repository contains a `.github/dependabot.yml` file.
- Approve pull requests.
- Merge pull requests.

## Configuration

The following configuration settings are available to change the behaviour of
the application.

| Key | Type | Default | Description |
|:--|:--|:--|:--|
| `Dependabot:CacheLifetime` | `TimeSpan` | `00:10:00` | The period users, organizations and repositories are cached for. |
| `Dependabot:DisableCaching` | `bool` | `false` | Disables caching of users, organizations and repositories in memory. |
| `Dependabot:IncludeForks` | `bool` | `false` | Whether to show forked repositories. |
| `Dependabot:IncludePrivate` | `bool` | `false` | Whether to show private and internal repositories. |
| `Dependabot:Labels` | `string[]` | `[ "dependencies" ]` | The label(s) pull requests must have to be shown. |
| `Dependabot:MergeRetryWaits` | `TimeSpan[]` | `[ "00:00:01", "00:00:02" ]` | The period(s) to wait when attempting to merge pull requests if a merge fails due to the pull request not being mergeable. |
| `Dependabot:RefreshPeriod` | `TimeSpan` | `00:10:00` | The approximate interval after which the status of the configured repositories is refreshed. |
| `Dependabot:Users` | `string[]` | `[ "app/dependabot", "app/github-actions" ]` | The users(s) pull requests must be created by to be shown. |
| `GitHub:ClientId` | `string` | - | The client ID for the GitHub OAuth application to use. |
| `GitHub:ClientSecret` | `string` | - | The client secret for the GitHub OAuth application to use. |
| `GitHub:EnterpriseDomain` | `string` | - | The URL of a GitHub Enterprise Server instance to use instead of GitHub.com. |
| `GitHub:Scopes` | `string[]` | `[ "repo" ]` | The scope(s) to request for the OAuth token when a user authenticates with the application. |
